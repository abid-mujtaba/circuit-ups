% Tutorial Source: http://www.latex-tutorial.com/tutorials/advanced/lesson-12/

\documentclass{article}


\usepackage{amsmath}
\usepackage{caption}        % To use the \caption* command which suppresses the "Figure:" prefix
\usepackage{tikz}
\usepackage[siunitx]{circuitikz}

% Suppress page numbering
\pagenumbering{gobble}

% Include the tex code that defines the 3 pin IC we will use for the 7805
\input{ic3pin}

% We define a new command which uses sub-stack from the amsmath package to create two line labels 
\newcommand\twoline[2]{$\substack{#1\\#2}$}         % Note that \substack must be containined within the math env $$. The advantage is that we don't have to specify $ around the arguments we provide to \twoline


\begin{document}

   \begin{center}

      \begin{figure}[h!]

         \begin{circuitikz}

            \tikzstyle{every node}=[font=\tiny]         % We reduce the font size of all text rendered in the circuit diagram

            % We reduce the size of all components in the diagram
            \ctikzset{bipoles/length=0.6cm}
            % We increase the size of the battery for aesthetic reasons
            \tikzset{battery/.append style={bipoles/length=1cm}}


            % Begin specifying the circuit
            \draw (1, 3) to[short, o-] (3, 3);          % We start with a line with a circular node on one end (from (1,3) to (3,3) on the grid)

            \draw (1, 0) to[short, o-] (3, 0);          % A similar line is drawn below it.


            \draw (0.25, 3) node[] {$+\SI{12}{\volt}$ DC};      % We place free floating text as nodes at specified location
            \draw (0.25, 2.75) node[] {(Input)};

            \draw (0.25, 0) node[] {DC GND};

            \draw (3, 0)                                % We draw a path from (3,0). Every segment contains a component or a short with the ending co.ods at the end
            to[battery, l=\twoline{\SI{12}{\volt}}{\SI{4.5}{\ampere\hour}}] (3, 2)      % Note the use of \twoline for two line labels
            to[R, l=\twoline{\SI{68}{\ohm}}{\SI{0.5}{\watt}}] (3, 3)                    % Note the use of \SI to place units after the value
            -- (4.5, 3)
            ;

            \draw (3, 2) -- (4.5, 2)
            to[diode, l^={1N4007}] (4.5, 3)      % we use 'l_' to specify that the label should appear on the right of the diode
            ;

            \draw (4.5, 2)
            to[pR, l_=$\SI{10}{k\ohm}$] (4.5, 1) |- (3,0);          % Note use of |- to create a wired path with a corner

            \draw (4.5, 3) -- (6, 3)
            to[R, l_=$\SI{1}{k\ohm}$] (6, 2)
            ;

            \draw (6, 1.5)          % An npn transistor is a tri-pole where we name the component as well as its three poles
            node[npn](t1) {}        % We name this component 't1' which is how we refer to it later
            (t1.base) node[anchor=west] {}              % We specify that the anchor points east where north points towards teh bottom
            (t1.collector) node[] {}
            (t1.emitter) node[anchor=north, xshift=-0.5cm, yshift=0.5cm] {BC548}        % We use the emitter label to label the whole transistor. We use xshift and yshift to move the position of the label
            ;

            \draw (t1.emitter)          % Instead of the starting position we specify the pole/anchor from the transistor
            to[empty led, l={Red}] (6, 0) -- (4.5, 0)
            ;

            \draw (t1.base) -- (4.75, 1.5);

            \draw (6, 2) -- (6.5, 2)
            to[pR, l_=$\SI{22}{k\ohm}$] (7.5, 2)
            ;

            \draw (6.25, 2) -- (6.25, 2.5) -| (7, 2.25);                 % We draw the shorted path from the wire to the arrow on top of the potentiometer

            \draw (8.5, 1.5)
            to[Tpnp, n=t2] (8.5, 2.5)           % Since we want a rotated pnp transistor with the current flowing left to right we use the 'Tpnp' (T at the start( notation to put the transistor in the path. We use the 'n' option to name it 't2' which will give us access to its anchors later.
            ;

            \draw (6,3) -| (t2.emitter);

            \draw (8, 2.5) node[] {TIP 127};        % Place the label of the transistor as a separate empty node (avoid complications due to rotation and the like)

            \draw (t2.base) -- (7.75, 2) -- (7.5, 2);             % Connect the base of the pnp transistor to the variable resistor using the -- notation. 

            \draw (9.75, 1.25) node[ic3pin] (ic3) {\textbf{7805}};

            \draw (8.95, 1.15) node[] {IN};
            \draw (9.45, 0.5) node[] {COM};
            \draw (10.7, 1.4) node[] {OUT};

            \draw (t2.collector) -- (ic3.pin1);                  % The -| notation allows us to construct right-angled shorted wires between the specified nodes. |- draws the corner in the opposite direction

            \draw (ic3.pin2) |- (4,0);

            \draw (ic3.pin3) -- (11, 1.25)
            to [R, l=$\SI{10}{k\ohm}$] (11, 0.5)
            to [empty led, l={Green}] (11, 0) -- (9.25, 0)
            ;

            \draw (10.5, 0) to[short, -o] (12, 0);
            \draw (11, 1.25) to [short, -o] (12, 1.25);
            \draw (8.25, 3) to[short, -o] (12, 3);

            \draw (6, 0) node[ground] {};               % We add a monopole (the GND symbol) at the specified location

            \draw (12.75, 1.25) node[] {+$\SI{5}{\volt}$ DC};
            \draw (12.75, 1) node[] {(Output)};

            \draw (12.75, 3) node[] {+$\SI{12}{\volt}$ DC};
            \draw (12.75, 2.75) node[] {(Output)};

            \draw (12.75, 0) node[] {DC GND};

         \end{circuitikz}

         \caption*{\tiny Mini-UPS (Uninterrupted Power Supply) for DC appliances}

      \end{figure}

   \end{center}

\end{document}
